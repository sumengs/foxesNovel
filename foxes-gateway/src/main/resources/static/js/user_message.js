(function(){window.User_Message={data:{tabIndex:0,loading:[false,false,false,false],list:[{},{},{},{}],pageSize:20,ready:[false,false,false,false]},watch:{topdataloading:"initData"},methods:{initData:function(){if(!this.ready[0]&&this.topdataloading[11]){Vue.set(this.ready,0,true);this.getList(0)}},setTabIndex:function(e){if(this.tabIndex==e)return;this.tabIndex=e;if(!this.ready[e]){Vue.set(this.ready,e,true);this.getList(0)}},setPageIndex:function(e){var t=this.tabIndex;if(this.list[t].pageIndex==e)return;this.list[t].pageIndex=e;if(!this.list[t].pages[e]){this.getList(e)}},goPageNum:function(){var e=this.tabIndex;var t=this.list[e].goPageNo;if(isNaN(t)||t<1||t>this.list[e].pageCount||t-1==this.list[e].pageIndex)return;this.list[e].goPageNo=t;this.list[e].pageIndex=t-1;if(!this.list[e].pages[t-1]){this.getList(t-1)}},showMessage:function(e){var t=this.list[this.tabIndex].pageIndex;var s=this.list[this.tabIndex].pages[t];s[e].ShowMessage=!s[e].ShowMessage;if(s[e].ShowCount==0){s[e].ShowCount=1;ajaxService("/Service/SetMyMessageState",{id:s[e].ID,type:s[e].MsgType},function(){})}Vue.set(this.list[this.tabIndex].pages,t,s)},getList:function(e){if(this.loading[this.tabIndex])return;Vue.set(this.loading,this.tabIndex,true);var t=this;ajaxService("/partview/getMyMessageList",{type:t.tabIndex,index:e,size:t.pageSize},function(s,i){Vue.set(t.loading,t.tabIndex,false);if(i==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(i==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(s!=""&&s.List.length>0){for(var a=0;a<s.List.length;a++){s.List[a].ShowMessage=false}if(e==0){Vue.set(t.list,t.tabIndex,t.setPage(s.PageCount,s.List))}else{t.list[t.tabIndex].pages[e]=s.List}}})},setPage:function(e,t){var s={pageIndex:0,pageCount:e,pages:new Array(e),goPageNo:1};s.pages[0]=t;return s},getMessageTypeName:function(e){var t="系统消息";switch(e){case 2:t="公告";break;case 3:t="活动";break;case 4:t="私信";break;case 5:t="作者";break}return t}}}})();