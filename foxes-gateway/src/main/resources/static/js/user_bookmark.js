(function(){window.User_Bookmark={data:{tabIndex:0,loading:false,bookMark:{},pageSize:20,ready:false},watch:{topdataloading:"initData"},methods:{initData:function(){if(!this.ready&&this.topdataloading[2]){this.ready=true;this.getMyBookMark()}},setTabIndex:function(e){if(this.tabIndex==e)return;this.tabIndex=e},setPageIndex:function(e){if(this.bookMark.pageIndex==e)return;this.bookMark.pageIndex=e;this.bookMark.allSel=false;this.bookMark.selItems=[]},goPageNum:function(){var e=this.bookMark.goPageNo;if(isNaN(e)||e<1||e>this.bookMark.pageCount||e-1==this.bookMark.pageIndex)return;this.bookMark.goPageNo=e;this.bookMark.pageIndex=e-1;this.bookMark.allSel=false;this.bookMark.selItems=[]},selAll:function(){var e=this.bookMark;if(e.allSel){var a=[];for(var o=0;o<e.pages[e.pageIndex].length;o++){if(!e.pages[e.pageIndex][o].HasDelete)a.push(e.pages[e.pageIndex][o].BookId)}e.selItems=a}else{e.selItems=[]}},delSingleBook:function(e){var a=this.bookMark.pageIndex;var o=this.bookMark.pages[a][e];if(o.HasDelete)return;this.delbookMark([o.BookId])},delSomeBook:function(){this.delbookMark(this.bookMark.selItems)},delbookMark:function(e){if(this.loading||e.length==0)return;var a=this;ajaxService("/Service/DeletebookMark",{bookid:e.join(",")},function(o,t){a.loading=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(t==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(o.Code==0){Util.showMsgBox("删除成功",1e3);a.setDeleteStatus(e)}else{if(o.Code==99){location.href="/UserValidator";return}Util.showMsgBox(o.Message,1e3)}})},setDeleteStatus:function(e){var a=[];for(var o in e){a[o]=e[o]}var t=false;for(var s=0;s<a.length;s++){t=false;for(var i=0;i<this.bookMark.pages.length;i++){if(t)break;for(var r=0;r<this.bookMark.pages[i].length;r++){if(this.bookMark.pages[i][r].BookId==a[s]){this.bookMark.pages[i][r].HasDelete=true;t=true;break}}}if(this.bookMark.selItems.length>0){var n=this.bookMark.selItems.indexOf(a[s]);if(n>=0){this.bookMark.selItems.splice(n,1)}}}},getMyBookMark:function(){if(this.loading)return;this.loading=true;var e=this;ajaxService("/partview/GetMyBookMark",{},function(a,o){e.loading=false;if(o==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(o==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(a!=""&&a.length>0){e.bookMark=e.setPage(a)}})},setPage:function(e){var a={pageIndex:0,pageCount:Math.ceil(e.length/this.pageSize),allSel:false,selItems:[],pages:[],goPageNo:1};var o=[];for(var t=0;t<e.length;t++){if(o.length==this.pageSize){a.pages.push(o);o=[]}e[t].HasDelete=false;o.push(e[t])}a.pages.push(o);return a}}}})();