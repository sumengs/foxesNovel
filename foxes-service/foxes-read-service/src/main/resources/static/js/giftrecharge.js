(function(){window.giftRecharge={loading:[false,false,false],type:-1,orderNo:["","",""],payInfo:["","",""],giftType:38,giftPrice:5e4,giftName:"",bookId:0,timer:null,timerStart:false,timerLoading:false,checkTimes:0,pageObj:{box:null,qrcode:null,closeBoxBtn:null},init:function(e,t,i){this.giftType=e;this.giftPrice=t;this.bookId=i;this.pageObj.box=$("#giftrecharge-box");this.pageObj.qrcode=$("#giftrecharge-qrcode");this.pageObj.closeBoxBtn=$("#giftrecharge-closebtn");this.bindAction();if(e==38){this.giftName="女王斗篷";$("#giftrecharge-giftinfo").html("女王斗篷（500元）")}else if(e==39){this.giftName="至尊权杖";$("#giftrecharge-giftinfo").html("至尊权杖（1000元）")}else{this.giftName="绝代佳人";$("#giftrecharge-giftinfo").html("绝代佳人（10000元）")}this.pageObj.box.show()},bindAction:function(){var e=this;$("#giftrecharge-type li").click(function(){var t=parseInt($(this).attr("data-type"));if(e.type==t)return;e.type=t;if(t>0){$("#qrcode-type"+t).show().siblings().hide();e.pageObj.qrcode.show();if(e.orderNo[t]=="")e.getRechargeInfo(t)}else{e.pageObj.qrcode.hide();e.getRechargeInfo(t)}$(this).addClass("active").siblings().removeClass("active")});this.pageObj.closeBoxBtn.click(function(){e.initParams()})},initParams:function(){this.pageObj.box.hide();if(this.timerStart){clearInterval(this.timer);this.timerStart=false}this.loading=[false,false,false];this.type=-1;this.orderNo=["","",""];this.payInfo=["","",""];this.giftType=38;this.giftPrice=5e4;this.giftName="";this.pageObj.qrcode.hide();$("#giftrecharge-type li").removeClass("active");$("#qrcode-type1").html("");$("#qrcode-type2").html("")},getRechargeInfo:function(e){if(this.loading[e])return;this.loading[e]=true;var t=this;ajaxPostService("/service/getgiftrechargeinfo",{type:e,price:t.giftPrice},function(i,r){t.loading[e]=false;if(r==1){Util.showMsgBox("网络连接异常，请稍后再试");return}else if(r==2){Util.showMsgBox("系统错误，请稍后再试");return}if(i.Code==0){t.orderNo[e]=i.OrderNo;if(e==0){window.open(i.PayInfo)}else{$("#qrcode-type"+e).html('<img src="data:image/png;base64,'+i.ImageData+'">')}if(!t.timerStart)t.setCeckTimer()}else{Util.showMsgBox(i.Message)}})},setCeckTimer:function(){var e=this;this.timerStart=true;this.checkTimes=0;this.timer=setInterval(function(){e.checkOrderState()},3e3)},checkOrderState:function(){if(this.checkTimes>100){clearInterval(this.timer);this.timerStart=false;return}if(this.timerLoading)return;this.timerLoading=true;var e=this;var t=this.orderNo.join(",");ajaxPostService("/service/checkgiftrechargestate",{orders:t,bookId:e.bookId,type:e.giftType},function(t,i){e.timerLoading=false;if(i==1||i==2){return}e.checkTimes++;if(t.Code==0){var r={title:e.giftName+" - 打赏成功",text:"您的全站广播正在准备发布，若当前已有全站广播产生，<br>则您的发布将有可能顺延一段时间。",btnText:"确定"};e.initParams();commonBox.confirmAlertBox(r)}})}}})();