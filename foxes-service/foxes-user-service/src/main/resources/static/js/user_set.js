(function(){window.User_Set={data:{loading:false,tabIndex:0,sex:-1,smsTimeLess:0,imgCode:"",setPassword:{mobile:"",vcode:"",smsVcode:"",smsTimeLess:0,loading:false,oldpassword:"",newpassword:"",copynewpassword:"",showSet:false},setNickName:{show:false,newNickName:"",loading:false},setFace:{show:false,faceTabIndex:0,loading:false,faceIndex:[1,1]},setSex:{loading:false},setMobile:{show:false},switchList:[0,0,0,0,0],settingLoading:false},watch:{topdataloading:"initData"},methods:{initData:function(){if(this.sex<0){this.sex=this.topuserinfo.sex;for(var s=0;s<this.topuserinfo.switchList.length;s++){this.switchList[s]=this.topuserinfo.switchList[s]}}},setTabIndex:function(s){this.tabIndex=s;if(s==1){this.setImageVcode();this.uploadPageInfo(170,true,"",new Date,null)}},showBindMobile:function(){this.setMobile.show=!this.setMobile.show;if(this.setMobile.show&&this.topuserinfo.mobile=="")this.uploadPageInfo(171,true,"",new Date,null)},showSelectFace:function(s){if(s)this.setFace.faceTabIndex=this.topuserinfo.sex;this.setFace.show=s},setFaceTabIndex:function(s){this.setFace.faceTabIndex=s},setFaceIndex:function(s,e){Vue.set(this.setFace.faceIndex,s,e)},setImageVcode:function(){this.imgCode="/Validation/ImageCode?rnd="+Math.random()},changePassBySmsCode:function(){if(this.setPassword.loading)return;if(this.setPassword.smsVcode==""){Util.showMsgBox("请输入手机验证码");return}if(this.setPassword.newpassword==""){Util.showMsgBox("请输入新密码");return}if(this.setPassword.newpassword!=this.setPassword.copynewpassword){Util.showMsgBox("两次输入的密码不一致");return}var s=Check.CheckPassWord(this.setPassword.newpassword);if(s!=""){Util.showMsgBox(s,1e3);return}this.changePass()},changePassByOldPass:function(){if(this.setPassword.loading)return;if(this.setPassword.oldpassword==""){Util.showMsgBox("请输入原密码");return}if(this.setPassword.newpassword==""){Util.showMsgBox("请输入新密码");return}if(this.setPassword.newpassword!=this.setPassword.copynewpassword){Util.showMsgBox("两次输入的密码不一致");return}var s=Check.CheckPassWord(this.setPassword.newpassword);if(s!=""){Util.showMsgBox(s,1e3);return}this.changePass()},changePass:function(){var s=this;s.setPassword.loading=true;ajaxService("/Service/ChangePassword",{oldpass:s.setPassword.oldpassword,newpass:s.setPassword.newpassword,smscode:s.setPassword.smsVcode},function(e,t){s.setPassword.loading=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(t==2){Util.showMsgBox("系统错误，请稍后再试");return}if(e.Code==0){Util.showMsgBox("密码修改成功，请重新登录");setTimeout(function(){location.href="/login/logout?r="+encodeURIComponent(location.href)},1e3)}else{Util.showMsgBox(e.Message,1e3)}})},getSmsCode:function(){if(this.setPassword.loading)return;if(this.setPassword.mobile==""){Util.showMsgBox("请输入手机号",1e3);return}if(/^1\d{10}$/.test(this.setPassword.mobile)==false){Util.showMsgBox("手机号格式错误，请输入11位中国大陆手机号");return}if(this.setPassword.vcode==""){Util.showMsgBox("请输入验证码");return}var s=this;s.setPassword.loading=true;ajaxService("/Service/SendChangePassSmsCode",{mobile:this.setPassword.mobile,vcode:this.setPassword.vcode},function(e,t){s.setPassword.loading=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(t==2){Util.showMsgBox("系统错误，请稍后再试");return}if(e.Code==0){Util.showMsgBox("验证码发送成功");s.setPassword.showSet=true;s.setPassword.smsTimeLess=120;var i=setInterval(function(){s.setPassword.smsTimeLess--;if(s.setPassword.smsTimeLess==0){clearInterval(i)}},1e3)}else{Util.showMsgBox(e.Message,1e3);s.setImageVcode()}})},saveSex:function(){if(this.setSex.loading)return;var s=this;s.setSex.loading=true;ajaxService("/Service/SetSex",{sex:this.sex},function(e,t){s.setSex.loading=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(t==2){Util.showMsgBox("系统错误，请稍后再试");return}if(e.Code==1){Util.showMsgBox("设置成功");s.topuserinfo.sex=s.sex}else{Util.showMsgBox("设置失败")}})},saveSwitchSet:function(s){if(this.settingLoading.loading)return;var e=this;e.settingLoading=true;ajaxService("/Service/SetUserSwitch",{type:s,value:e.switchList[s]},function(t,i){e.settingLoading=false;if(i==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(i==2){Util.showMsgBox("系统错误，请稍后再试");return}if(t.Code==0){Util.showMsgBox("设置成功");Vue.set(e.topuserinfo.switchList,s,e.switchList[s])}else{Util.showMsgBox(t.Message)}})},saveFace:function(){if(this.setFace.loading)return;var s=this.setFace.faceIndex[this.setFace.faceTabIndex].toString().fill(2,"0");var e=(this.setFace.faceTabIndex==0?"girl/100":"boy/100")+s+".jpg";var t=this;t.setFace.loading=true;ajaxService("/Service/SetFace",{face:e},function(s,i){t.setFace.loading=false;if(i==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(i==2){Util.showMsgBox("系统错误，请稍后再试");return}if(s.Code==1){Util.showMsgBox("新头像设置成功");t.topuserinfo.face=e;t.setFace.show=false}else{Util.showMsgBox("新头像设置失败")}})},saveNickName:function(){if(this.setNickName.loading)return;var s=this.checkNickName(this.setNickName.newNickName);if(s!=""){Util.showMsgBox(s,1e3);return}var e=this;e.setNickName.loading=true;ajaxService("/Service/SetNickName",{nickname:this.setNickName.newNickName},function(s,t){e.setNickName.loading=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(t==2){Util.showMsgBox("系统错误，请稍后再试");return}if(s.Code==0){Util.showMsgBox("设置成功");e.topuserinfo.nickName=e.setNickName.newNickName}else{Util.showMsgBox(s.Message)}})},checkNickName:function(s){if(s.length<3||s.length>12){return"昵称长度只能在3-12位字符之间"}if(/^[(0-9A-Za-z)(\u4e00-\u9fa5)]{2,}$/gi.test(s)==false){return"昵称只能由汉字、字母、数字组成"}if(/^[0-9]*$/g.test(s)==true){return"昵称不能为纯数字"}return""},uploadPageInfo:function(s,e,t,i,o){try{statPcPage.uploadStaticPageInfo(s,e,t,i,o)}catch(s){}}}}})();