(function(){window.User_Task={data:{taskState:[],initLoading:true,hasInitData:false,loading:[false,false,false,false,false,false],addTiyanbiCount:[100,10,10,2,5,10],weekSigned:{rewardList:[],todayIndex:0,todayIsSigned:false,loading:false},totalSigned:{taskList:[],signedTotalCount:0,loading:false},weekName:["周一","周二","周三","周四","周五","周六","周日"],signedRewardBox:{show:false,rewardList:[]},weekSignedRulesShow:false},watch:{topdataloading:"initData"},methods:{initData:function(){if(!this.hasInitData&&this.initLoading&&this.topdataloading[7]){this.hasInitData=true;var e=this;ajaxService("/signed/GetSignTaskState",{},function(t,i){if(i==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(i==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}e.initLoading=false;if(t!=""&&t.CommonTaskList.length>0){e.taskState=t.CommonTaskList;e.weekSigned.rewardList=t.WeekSignedInfo.Reward;e.weekSigned.todayIndex=t.WeekSignedInfo.TodayWeekIndex;e.weekSigned.todayIsSigned=t.WeekSignedInfo.TodayIsSigned==1;e.totalSigned.taskList=t.TotalSignedTaskList;e.totalSigned.signedTotalCount=t.TotalSignedDayCount}})}},getReward:function(e){var t=e-1;if(this.loading[t])return;Vue.set(this.loading,t,true);var i=this;ajaxService("/service/GetTaskReward",{type:e},function(e,a){Vue.set(i.loading,t,false);if(a==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(a==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(e.Code==0){Vue.set(i.taskState,t,998);i.$emit("method-set-tiyanbi-count",i.addTiyanbiCount[t]);Util.showMsgBox("领取成功")}else{Util.showMsgBox("领取失败")}})},getTotalSignedReward:function(){var e=this.totalSigned.taskList[0].TaskId;if(this.totalSigned.loading)return;this.totalSigned.loading=true;var t=this;ajaxService("/service/GetTotalSignedReward",{type:e},function(e,i){t.totalSigned.loading=false;if(i==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(i==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(e.Code==0){var a;var s;var n;for(var o=0;o<t.totalSigned.taskList[0].TaskItems.length;o++){a=t.totalSigned.taskList[0].TaskItems[o];s=t.topisvip==0?a.Iid1:a.Iid2;n=a.Count;t.signedRewardBox.rewardList.push({iid:s,count:n});if(s==1){t.$emit("method-set-yuanbao-count",n)}else if(s==2){t.$emit("method-set-yuepiao-count",n)}else if(s==3){t.$emit("method-set-pingjiapiao-count",n)}else if(s==4){t.$emit("method-set-tiyanbi-count",n)}}t.signedRewardBox.show=true;t.totalSigned.taskList.splice(0,1)}else{Util.showMsgBox(e.Message)}})},getWeekSignedReward:function(){if(this.weekSigned.loading)return;this.weekSigned.loading=true;var e=this;ajaxService("/service/GetWeekSignedReward",{},function(t,i){e.weekSigned.loading=false;if(i==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(i==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(t.Code==0){var a=e.weekSigned.rewardList[e.weekSigned.todayIndex];e.weekSigned.todayIsSigned=true;e.totalSigned.signedTotalCount++;e.$emit("method-set-yuanbao-count",a);e.signedRewardBox.rewardList.push({iid:1,count:a});e.signedRewardBox.show=true}else{Util.showMsgBox(t.Message)}})},hideSignedRewardBox:function(){this.signedRewardBox.show=false;this.signedRewardBox.rewardList=[]},totalSignedRewardText:function(e){var t="";for(var i=0;i<e.length;i++){t+=i>0?"，":"";t+=e[i].Count+this.rewardName(e[i])}return t},rewardName:function(e){var t=this.topisvip==0?e.Iid1:e.Iid2;if(t==1){return"元宝"}else if(t==2){return"张月票"}else if(t==3){return"张评价票"}else if(t==4){return"体验币"}}}}})();