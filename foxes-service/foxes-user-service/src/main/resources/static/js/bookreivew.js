(function(){var e=0;var t=10;var i=[false,false];var r=1;var a=[-1,-1];var o=[0,0];var n=[true,true];var l=[$("#reviewTab0"),$("#reviewTab1")];var s=[$("#reviewContent0"),$("#reviewContent1")];var v=[$("#reviewGetMore0"),$("#reviewGetMore1")];var c=$(document);var u=$(window);var w=false;window.initBookReview=function(t){e=t};$(".setreviewtab").click(function(){var e=parseInt($(this).attr("data-value"));if(r==e)return;r=e;if(a[e]<0){f()}$(this).addClass("active").siblings(".setreviewtab").removeClass("active");l[e].show().siblings().hide()});$(".load-more").click(function(){f()});function f(){var c=r;if(i[c]||!n[c])return;a[c]++;i[c]=true;v[c].html("正在加载 . . .");$.get("/partview/GetBookReview",$.param({bookid:e,index:a[c],size:t,sort:c}),function(e){i[c]=false;s[c].append(e);if(a[c]==0){var r=l[c].find("#total");if(r.length>0){o[c]=r.attr("data-value")}if(c==1)$(".reviewtotal").html("（"+o[c]+"条）")}if(o[c]>(a[c]+1)*t){n[c]=true;v[c].html('更多<i class="iconfont">&#xe601;</i>')}else{n[c]=false;v[c].html("没有更多了")}})}window.reportReview=function(e,t){if(!window.hasLogin){window.login();return}if(w)return;var i={title:"举报书评",text:'<ul class="map-menu"><li><label><input type="radio" name="reportreview" value="1">低俗色情</label></li><li style="ma"><label><input type="radio" name="reportreview" value="2">政治敏感</label></li><li><label><input type="radio" name="reportreview" value="4">营销广告</label></li></ul>',btnText:"确认",showCancel:true,check:function(){var e=parseInt($("input[name='reportreview']:checked").val());if(!e||e==0){Util.showMsgBox("请选择举报原因");return false}return true},callback:function(i){postReportReview(e,t,i)}};commonBox.confirmBox(i)};window.postReportReview=function(e,t,i){var r=parseInt($("input[name='reportreview']:checked").val());w=true;ajaxPostService("/service/ReportComment",{commentType:0,commentId:e,reportType:r,reportUserId:t},function(t,r){w=false;if(r==1){Util.showMsgBox("网络连接异常，请稍后再试");return}if(r==2){Util.showMsgBox("系统错误，请稍后再试");return}if(t.Code==0){Util.showMsgBox("举报成功");$(".reportreview"+e).css({color:"#fb6b84"}).html("已举报")}else{Util.showMsgBox(t.Message)}i()})};window.likeReview=function(e){commentAction.like(e,function(){var t=$(".likecount"+e);var i=parseInt(t.attr("data-count"))+1;t.addClass("haslike").html('<i class="iconfont">&#xe614;</i>'+i+"点赞")})}})();