(function(){var e={};var t=false;var a=false;var o="";var i=false;var r=false;var n;var s=false;var l=$(window);var c=$(document);var d=$("#menu-left");var u=$("#menu-right");var f=$(".backTop");var h={};var p=0;var v={};window.Init=function(t){e=t;for(var a in e.readSet){v[a]=e.readSet[a]}h.account=t.useraccount;h.yuanbao=t.useryuanbao;h.tiyanbi=t.usertiyanbi;p=t.initAuto||0;w();g(e.readSet.pageWidth);if(t.limiDiscount)m(t.limitDiscountTime);if(e.hasLogin&&e.viewName!="subscribe"&&e.chapterid>0&&e.volumeID!=999999)I();$(document).keydown(function(t){if($(".active_li").length==0&&$("#giftview").length==0){if(t.which==37){if(e.preChapterId>0){location.href="/chapter/"+e.preChapterId+".html"}else if(!e.IsCover){location.href="/bookcoverinfo/"+e.bookid}}else if(t.which==39&&e.nextChapterId>0){location.href="/chapter/"+e.nextChapterId+".html"}}})};function m(e){var t=$("#limitdiscounttime");var a=setInterval(function(){var o=Util.leftTimer(e.year,e.month,e.day,e.hour,e.minute,e.second);if(o.less){var i="剩余"+parseInt(24*o.days+o.hours)+"小时"+o.minutes+"分"+o.seconds+"秒";t.html(i)}else{clearInterval(a);$("#discountinfo").html("限时折扣已结束")}},1e3)}function b(){for(var t in e.readSet){v[t]=e.readSet[t]}$('.color-mode span[data-value="'+e.readSet.colorStyle+'"]').addClass("current").siblings().removeClass("current");$("#readcontent").attr("class",e.readSet.colorStyle);$('.fontfamily-mode span[data-value="'+e.readSet.fontStyle+'"]').addClass("current").siblings().removeClass("current");$("#auto-chapter").css("font-family",e.readSet.fontStyle);$(".fontsize-text").text(e.readSet.fontSize);$("#auto-chapter").css("font-size",e.readSet.fontSize);$(".websize-text").text(e.readSet.pageWidth);$("#auto-container").css("width",e.readSet.pageWidth);d.css("margin-left",(e.readSet.pageWidth/2+70)*-1);u.css("margin-left",e.readSet.pageWidth/2+10);e.readSet.scrollMode==0?$(".auto-read .auto-read-btn").addClass("auto-read-close").text("关闭"):$(".auto-read .auto-read-btn").removeClass("auto-read-close").text("打开");$("#scorllSpeed").html(e.readSet.scrollSpeed);e.readSet.autoNextPage==1?$("#pagemode").attr("checked","true"):$("#pagemode").removeAttr("checked");w();x()}$("#savereadset").click(function(){$("#readsetmenu").removeClass("active_li").children(".nav-box").hide();for(var t in v){e.readSet[t]=v[t]}var a=e.readSet.colorStyle+"|"+e.readSet.fontStyle+"|"+e.readSet.fontSize+"|"+e.readSet.pageWidth+"|"+e.readSet.scrollMode+"|"+e.readSet.scrollSpeed+"|"+e.readSet.autoNextPage;myhead.setCookie("pcreadmodel",a,999);w();x()});$(".nav-box .nav-hd .closebtn, #cancelReadSet").click(function(){$(this).parents(".nav-box").hide().parents("li").removeClass("active_li");if($(this).hasClass("forreadset"))b()});$("#menu-left .nav-set-li .nav-icon").click(function(){var e=$(this).parents("li");var a=e.index();if(a==0&&!t){C()}if($("#readsetmenu").hasClass("active_li")){b()}if(e.hasClass("active_li")){e.removeClass("active_li").children(".nav-box").hide()}else{e.addClass("active_li").children(".nav-box").show();e.siblings().removeClass("active_li").children(".nav-box").hide()}});$(".color-mode span").click(function(){var e=$(this).attr("data-value");$("#readcontent").attr("class",e);$(this).addClass("current").siblings().removeClass("current");v.colorStyle=e});$(".fontfamily-mode span").click(function(){var e=$(this).attr("data-value");$("#auto-chapter").css("font-family",e);$(this).addClass("current").siblings().removeClass("current");v.fontStyle=e});$(".fontsize-plus, .fontsize-minus").click(function(){var e=$(this).attr("class");var t=parseInt($(".fontsize-text").text());if(e=="fontsize-minus"){if(t-2<14)t=14;else t-=2}else{if(t+2>48)t=48;else t+=2}$(".fontsize-text").text(t);$("#auto-chapter").css("font-size",t);v.fontSize=t;x()});$(".websize-plus, .websize-minus").click(function(){var e=$(this).attr("class");var t=parseInt($(".websize-text").text());if(e=="websize-minus"){if(t-160<640)t=640;else t-=160}else{if(t+160>1280)t=1280;else t+=160}g(t)});function g(e){$(".websize-text").text(e);$("#auto-container").css("width",e);d.css("margin-left",(e/2+70)*-1);u.css("margin-left",e/2+10);v.pageWidth=e;x()}$(".auto-read").click(function(){var e=$(this).find(".auto-read-btn");if(e.hasClass("auto-read-close")){e.removeClass("auto-read-close").text("打开");v.scrollMode=1}else{e.addClass("auto-read-close").text("关闭");v.scrollMode=0}w()});$(".scrollspeed-minus, .scrollspeed-plus").click(function(){var e=parseInt($(this).attr("data-value"));if(v.scrollSpeed+e<1||v.scrollSpeed+e>20){return}v.scrollSpeed+=e;$("#scorllSpeed").html(v.scrollSpeed);w()});$("#pagemode").click(function(){v.autoNextPage=$(this).is(":checked")?1:0});function w(){if(e.viewName!="nologin"&&e.viewName!="changing"&&e.viewName!="subscribe"&&v.scrollMode==1){clearInterval(n);n=setInterval(function(){if($(".active_li").length==0&&$("#giftview").length==0){window.scrollBy(0,1);S()}},200/v.scrollSpeed)}else{clearInterval(n)}}function S(){if(v.autoNextPage==1&&e.nextChapterId>0&&$(window).scrollTop()+$(window).height()==$(document).height()&&!s){clearInterval(n);s=true;location.href="/chapter/"+e.nextChapterId+".html"}}function x(){var e=l.height(),t=c.height();var a=$(".area_1200").length>0?193:93;var o=leftBarTop=a;var i=rightBarBottom=156,r;winScrollTop=l.scrollTop();if(winScrollTop>=leftBarTop&&o!=0){o=0;d.css("top",o)}else if(winScrollTop<leftBarTop){o=leftBarTop-winScrollTop;d.css("top",o+1)}r=t-e-rightBarBottom;if(winScrollTop<=r&&i!=0){i=0;u.css("bottom",i)}else if(winScrollTop>r){i=rightBarBottom-t+e+winScrollTop;u.css("bottom",i)}if(winScrollTop>0){f.show()}else{f.hide()}}c.bind("scroll",function(){x()});function C(){t=true;initChapterListNoSub(e.bookid,e.isvip,e.maxChapterId)}$(".showgiftbox").click(function(){if(e.hasLogin){var t=parseInt($(this).attr("data-index"));window.showGiftBox(t,e.bookid,e.isvip,e.bonusType==3)}else{window.login()}});$("#btn_subcribechapter").click(function(){if(a){return}if(e.needCount>h.yuanbao+h.account&&e.needCount>h.tiyanbi){k(e.chapterid,e.needCount)}else{var t=$("#order_next").is(":checked")?1:0;y(e.chapterid,t)}});$("#btn_subcribeallchapter").click(function(){if(a)return;k(e.allChapter,e.subAllChapterNeedCount)});function k(e,t){var a="余额<em>"+h.account+"</em>潇湘币";if(h.yuanbao>0){a+="，<em>"+h.yuanbao+"</em>元宝"}if(h.tiyanbi>0){a+="，<em>"+h.tiyanbi+"</em>体验币"}var o=0;var i=0;var r="本次订阅需消耗"+t+"点";var n=t<=h.yuanbao+h.account||t<=h.tiyanbi;var s={title:"订阅",text:r+"<br><span>"+a+"</span>",btnText:n?"确认订阅":"去充值",showCancel:false,callback:n?function(t){y(e,-1,t)}:function(){window.open("http://recharge.xxsy.net/")}};commonBox.confirmBox(s)}function y(t,o,i){a=true;ajaxPostService("/Service/subcribechapter",{bookid:e.bookid,arrchapterid:t,auto:o,initAuto:p},function(e,t){a=false;if(t==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(t==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(e.Code==99){location.href="/UserValidator";return}if(e.Code==0){var o=e.Data;var r="订阅成功";if(o.Mon>0){r+=",本次订阅获取月票"+o.Mon+"张"}if(o.Ass>0){r+=",本次订阅获取评价票1张"}if(typeof i=="function")i();Util.showMsgBox(r,2e3);setTimeout(function(){location.reload()},500)}else{Util.showMsgBox(e.Message,2e3)}})}$("#addshelf").click(function(){if(menuBookCase._loading)return;if(!e.hasLogin){window.login();return}if(e.hasInShelf){Util.showMsgBox("已加入书架",2e3);return}menuBookCase.addBookCase(e.bookid,function(){e.hasInShelf=true;i=false})});$("#addmark").click(function(){if(menuBookCase._loading)return;if(!e.hasLogin){window.login();return}if(r){Util.showMsgBox("已加入书签",2e3);return}ajaxPostService("/service/AddBookMark",{bookid:e.bookid,chapterid:e.chapterid},function(e,t){if(t==1){Util.showMsgBox("网络连接异常，请稍后再试",1e3);return}if(t==2){Util.showMsgBox("系统错误，请稍后再试",1e3);return}if(e.Code!=0){Util.showMsgBox(e.Message,1e3);return}r=true;Util.showMsgBox("加入书签成功",1e3)})});function B(){$.post("/Chapter/SyncReadProgress",$.param({bookid:e.bookid,chapterid:e.chapterid,wordcount:e.wordCount,set:0}),function(t){if(t.Code==0){var a={title:"云端有新的阅读进度，是否跳转？",text:"<p>云端进度："+t.ProgressChapterName+"<br>当前进度："+e.chaptername+"</span>",btnText:"确定",showCancel:true,callback:function(e){e();location.href="/chapter/"+t.ProgressChapterId+".html"},cancelCallback:function(){I()}};commonBox.confirmBox(a)}})}function I(){$.post("/Chapter/SyncReadProgress",$.param({bookid:e.bookid,chapterid:e.chapterid,wordcount:e.wordCount,set:1}),function(e){})}})();